From 26b0276048ad4da1376bf70ad8e12b3a2e76ce66 Mon Sep 17 00:00:00 2001
Message-Id: <26b0276048ad4da1376bf70ad8e12b3a2e76ce66.1511879462.git.marcel.ziswiler@toradex.com>
In-Reply-To: <dea7cf41838e5dcbf93eaa4c95901f7eddb777fa.1511879462.git.marcel.ziswiler@toradex.com>
References: <dea7cf41838e5dcbf93eaa4c95901f7eddb777fa.1511879462.git.marcel.ziswiler@toradex.com>
From: Marcel Ziswiler <marcel.ziswiler@toradex.com>
Date: Sat, 25 Nov 2017 23:32:21 +0100
Subject: [PATCH 1/2] apalis-tk1: add configuration for tezi

Modify configuration for Tezi:
- Use distroboot by default
- Boot from external SD-cards by default
- Disable USB PID from config block (otherwise recovery mode download
  in U-Boot stage fails)

Signed-off-by: Marcel Ziswiler <marcel.ziswiler@toradex.com>
---
 include/configs/apalis-tk1.h        | 7 ++++---
 include/configs/tegra-common-post.h | 7 ++++---
 2 files changed, 8 insertions(+), 6 deletions(-)

diff --git a/include/configs/apalis-tk1.h b/include/configs/apalis-tk1.h
index 8ef8373972..b404827df3 100644
--- a/include/configs/apalis-tk1.h
+++ b/include/configs/apalis-tk1.h
@@ -37,12 +37,14 @@
 #define CONFIG_GENERIC_MMC
 #define CONFIG_SUPPORT_EMMC_BOOT	/* eMMC specific */
 
+#define CONFIG_ENV_IS_NOWHERE
+#ifdef CONFIG_ENV_IS_IN_MMC
 /* Environment in eMMC, before config block at the end of 1st "boot sector" */
-#define CONFIG_ENV_IS_IN_MMC
 #define CONFIG_ENV_OFFSET		(-CONFIG_ENV_SIZE + \
 					 CONFIG_TDX_CFG_BLOCK_OFFSET)
 #define CONFIG_SYS_MMC_ENV_DEV		0
 #define CONFIG_SYS_MMC_ENV_PART		1
+#endif
 
 /* USB host support */
 #define CONFIG_USB_EHCI
@@ -70,8 +72,7 @@
 #define CONFIG_SERVERIP		192.168.10.1
 
 #define CONFIG_BOOTCOMMAND \
-	"run emmcboot; setenv fdtfile ${soc}-${fdt_module}-${fdt_board}.dtb && " \
-		"run distro_bootcmd"
+	"run distro_bootcmd"
 
 #define DFU_ALT_EMMC_INFO	"apalis-tk1.img raw 0x0 0x500 mmcpart 1; " \
 				"boot part 0 1 mmcpart 0; " \
diff --git a/include/configs/tegra-common-post.h b/include/configs/tegra-common-post.h
index a9990b7383..32310bd277 100644
--- a/include/configs/tegra-common-post.h
+++ b/include/configs/tegra-common-post.h
@@ -23,9 +23,10 @@
 
 #ifndef CONFIG_SPL_BUILD
 #define BOOT_TARGET_DEVICES(func) \
-	func(MMC, mmc, 1) \
-	func(MMC, mmc, 0) \
-	func(USB, usb, 0) \
+        func(MMC, mmc, 1) \
+        func(MMC, mmc, 2) \
+        func(MMC, mmc, 0) \
+        func(USB, usb, 0) \
 	func(PXE, pxe, na) \
 	func(DHCP, dhcp, na)
 #include <config_distro_bootcmd.h>
-- 
2.13.6

