DISTRO_NAME="Toradex Easy Installer"
DISTRO_VERSION="2.4"

DISTRO_FEATURES="acl keyboard usbhost usbgadget ext2 largefile wayland wifi xattr ${DISTRO_FEATURES_LIBC_DEFAULT}"
DISTRO_FEATURES_BACKFILL_CONSIDERED="pulseaudio bluez5"

TCLIBC = "glibc"
IMAGE_LINGUAS = ""

TEZI_INITRD_IMAGE ?= "squashfs"

VIRTUAL-RUNTIME_dev_manager = "udev"
VIRTUAL-RUNTIME_login_manager = ""
VIRTUAL-RUNTIME_init_manager = "tezi-init"

MACHINE_EXTRA_RRECOMMENDS_remove = "udev-rules-imx"
MACHINE_EXTRA_RRECOMMENDS_append = " udev-rules-tezi"

# Avoid egl build dependency, which is not compatible with imx7 and we don't need it anyway
BBMASK += "/meta-freescale/dynamic-layers/qt5-layer/recipes-qt/qt5/"

# Qt5 extra configuration
PACKAGECONFIG_append_pn-qtbase = " linuxfb no-opengl xkbcommon"
PACKAGECONFIG_remove_pn-qtwayland = "wayland-egl wayland-server"

# Get rid of EGL and GLESv2 in cairo
PACKAGECONFIG_remove_pn-cairo = "egl glesv2"

# Override mainline u-boot until we decide on using it with tezi
PREFERRED_PROVIDER_virtual/bootloader_forcevariable = "u-boot-toradex"
PREFERRED_VERSION_u-boot-toradex ?= "2016.11"

PREFERRED_PROVIDER_u-boot-fw-utils = "u-boot-toradex-fsl-fw-utils"
PREFERRED_RPROVIDER_u-boot-fw-utils = "u-boot-toradex-fsl-fw-utils"
PREFERRED_PROVIDER_u-boot-fw-utils_mx8 = "u-boot-toradex-fw-utils"
PREFERRED_RPROVIDER_u-boot-fw-utils_mx8 = "u-boot-toradex-fw-utils"

PREFERRED_VERSION_linux-toradex = "4.9-1.0.x%"
PREFERRED_VERSION_linux-toradex_mx8 = "4.14%"
PREFERRED_VERSION_u-boot-distro-boot = "1.1"
PREFERRED_VERSION_weston_forcevariable = "6.0.92"
PREFERRED_VERSION_wayland_forcevariable = "1.17.0"
PREFERRED_VERSION_wayland-protocols_forcevariable = "1.18"

# Remove python from tezi-devel (gets pulled by gdb bbappend in meta-qt5)
PACKAGECONFIG_remove_pn-gdb = "python"

# Make sure we use OpenSSL only
PACKAGECONFIG_pn-curl = "ipv6 ssl proxy zlib"
PACKAGECONFIG_pn-wpa-supplicant = "openssl"

# Enable acl support in GNU tar
PACKAGECONFIG_pn-tar = "acl"

# Add License files to image
COPY_LIC_DIRS = "1"
COPY_LIC_MANIFEST = "1"

# Explicitly use zImage
KERNEL_IMAGETYPE = "zImage"

# Make sure kernel does not get deployed into rootfs
RDEPENDS_${KERNEL_PACKAGE_NAME}-base = ""
RDEPENDS_${KERNEL_PACKAGE_NAME}-image = ""

# No firmwares required for a simple Qt UI
MACHINE_FIRMWARE_remove_mx6q = "firmware-imx-vpu-imx6q"
MACHINE_FIRMWARE_remove_mx6dl = "firmware-imx-vpu-imx6d firmware-imx-epdc"
MACHINE_FIRMWARE_remove_mx7 = "firmware-imx-epdc"

# No TDX firmware for tezi image
MACHINE_EXTRA_RDEPENDS_remove_apalis-tk1 = "tdx-k20-fw"
MACHINE_EXTRA_RDEPENDS_remove_apalis-tk1-mainline = "tdx-k20-fw"

MACHINE_EXTRA_RDEPENDS_append_colibri-imx6ull = " mtd-utils-ubifs mtd-utils kobs-ng"
MACHINE_EXTRA_RDEPENDS_append_colibri-imx7 = " mtd-utils-ubifs mtd-utils kobs-ng"

# Enable sha384sum. This is upstreamed in meta-frescale warrior. Remove when
# upgrading
HOSTTOOLS_NONFATAL_append = " sha384sum"

UBOOT_MAKE_TARGET_mx6q = "u-boot.img SPL"
UBOOT_MAKE_TARGET_mx6dl = "u-boot.img SPL"
# work around colibri-imx7/colibri-imx6ull being overridden a second time
# later on in machine config
UBOOT_MAKE_TARGET_colibri-imx6ull_forcevariable = "u-boot-nand.imx"
UBOOT_MAKE_TARGET_colibri-imx7_forcevariable = "u-boot-nand.imx"

UBOOT_SUFFIX_mx6q = "img"
UBOOT_SUFFIX_mx6dl = "img"
SPL_BINARY_mx6q = "SPL"
SPL_BINARY_mx6dl = "SPL"

UBOOT_SDP_SUPPORT = "0"
UBOOT_SDP_SUPPORT_apalis-imx6 = "1"
UBOOT_SDP_SUPPORT_colibri-imx6 = "1"
UBOOT_SDP_SUPPORT_colibri-imx6ull = "1"
UBOOT_SDP_SUPPORT_colibri-imx7 = "1"
MACHINE_BOOT_FILES_append = " ${@oe.utils.ifelse(d.getVar('UBOOT_SDP_SUPPORT') == '1', 'boot-sdp.scr', '')}"

UBOOT_CONFIG_apalis-imx6 = "apalis-imx6-tezi"
UBOOT_CONFIG[apalis-imx6-tezi]="apalis_imx6_tezi_defconfig"

UBOOT_MACHINE_FW_UTILS_apalis-imx6="apalis_imx6_defconfig"

UBOOT_CONFIG_apalis-t30-mainline = "apalis-t30-tezi"
UBOOT_CONFIG[apalis-t30-tezi]="apalis_t30_tezi_defconfig"
UBOOT_MACHINE_apalis-t30-mainline = ""
UBOOT_MACHINE_FW_UTILS_apalis-t30-mainline="apalis_t30_defconfig"
UBOOT_SUFFIX_apalis-t30-mainline = "bin"

UBOOT_CONFIG_apalis-tk1 = "apalis-tk1-tezi"
UBOOT_CONFIG[apalis-tk1-tezi]="apalis-tk1_tezi_defconfig"
UBOOT_MACHINE_apalis-tk1 = ""
UBOOT_MACHINE_FW_UTILS_apalis-tk1="apalis-tk1_defconfig"
UBOOT_SUFFIX_apalis-tk1 = "bin"

UBOOT_CONFIG_apalis-tk1-mainline = "apalis-tk1-tezi"
UBOOT_CONFIG[apalis-tk1-tezi]="apalis-tk1_tezi_defconfig"
UBOOT_MACHINE_apalis-tk1-mainline = ""
UBOOT_MACHINE_FW_UTILS_apalis-tk1-mainline="apalis-tk1_defconfig"
UBOOT_SUFFIX_apalis-tk1-mainline = "bin"

UBOOT_CONFIG_colibri-imx6 = "colibri-imx6-tezi"
UBOOT_CONFIG[colibri-imx6-tezi]="colibri_imx6_tezi_defconfig"

UBOOT_MACHINE_FW_UTILS_colibri-imx6="colibri_imx6_defconfig"

UBOOT_MACHINE_colibri-imx6ull = ""
UBOOT_CONFIG_colibri-imx6ull = "colibri-imx6ull-tezi"
UBOOT_CONFIG[colibri-imx6ull-tezi]="colibri-imx6ull_tezi_defconfig"

UBOOT_MACHINE_FW_UTILS_colibri-imx6ull="colibri-imx6ull_defconfig"

UBOOT_MACHINE_FW_UTILS_colibri-imx7="colibri_imx7_defconfig"
UBOOT_MACHINE_FW_UTILS_colibri-imx7-emmc="colibri_imx7_emmc_defconfig"

require conf/tdx_version.conf
